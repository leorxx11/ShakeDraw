# 🎲 ShakeDraw - 晃动抽签

一款简洁优雅的iOS随机抽签应用，通过摇动手机或点击按钮从图片文件夹中随机选择图片。

![iOS Version](https://img.shields.io/badge/iOS-18.0+-blue.svg)
![Swift Version](https://img.shields.io/badge/Swift-5.0+-orange.svg)
![License](https://img.shields.io/badge/License-MIT-green.svg)

## ✨ 特色功能

### 🎯 核心功能
- **智能抽签**：从图片文件夹中随机选择图片
- **防重复机制**：确保连续抽签不会重复当前图片
- **多种触发方式**：支持摇一摇手机或点击按钮
- **记忆功能**：自动记住上次抽签结果和选择的文件夹
- **多文件夹管理**：在设置页导入多个文件夹，单独控制是否参与抽签，左划删除
- **分享扩展**：支持从Safari、相册等应用直接分享图片到ShakeDraw

### 🎨 界面设计
- **苹果设计风格**：遵循 Apple Human Interface Guidelines
- **平滑过渡**：结果图片采用交叉淡入 + 轻微缩放过渡，切换更自然
- **夜间模式适配**：完美支持系统深色/浅色模式切换
- **响应式布局**：优化竖屏图片显示，智能调整图片尺寸
 - **高斯模糊背景**：使用当前结果图片作为全屏背景并高斯模糊，增强沉浸感
 - **半透明按钮（自适配深色）**：左下角骰子按钮为毛玻璃圆形，仅在有图片时显示
 - **可见的按压反馈**：按钮按下轻微缩放与色彩叠加；点击后立即执行（移除人为延迟）

### 🔧 高级功能
- **设置页文件管理**：支持多文件夹导入、参与抽签开关、左划删除与一键清空配置
- **敏感摇动检测**：优化的重力感应，提高触发灵敏度
- **缓存机制**：预加载和缓存图片，提供流畅体验
- **安全访问**：使用安全范围资源访问，保护用户隐私
- **智能分享扩展**：
  - 支持多种图片格式（JPEG、PNG、WebP、HEIC、GIF等）
  - 智能预览功能，自动缩放和占位图显示
  - 优化的网络图片处理，支持Safari网页分享
  - 异步状态同步，确保保存状态反馈准确

## 📱 系统要求

- iOS 18.0+
- Xcode 15.0+
- Swift 5.0+

## 🚀 快速开始

### 安装运行

1. 克隆项目到本地
```bash
git clone https://github.com/leorxx11/ShakeDraw.git
cd ShakeDraw
```

2. 使用 Xcode 打开项目
```bash
open ShakeDraw.xcodeproj
```

3. 选择目标设备或模拟器，点击运行

### 使用方法

#### 主要功能
1. **打开设置**：主界面右上角齿轮按钮进入"设置"
2. **导入文件夹**：设置页右上角"+"导入一个或多个文件夹
3. **参与开关**：为每个文件夹单独控制"加入抽签"，可左划删除
4. **开始抽签**：回到主界面，摇动手机或点击左下角骰子按钮
5. **享受结果**：查看随机选中的图片；再次点击左下角按钮继续

#### 分享扩展
6. **Safari分享**：在Safari浏览图片时，点击分享按钮选择"ShakeDraw"
7. **相册分享**：在相册中选择图片，通过分享菜单选择"ShakeDraw"
8. **其他应用**：支持任何可分享图片的iOS应用

## 🏗️ 项目架构

### 核心组件
```
ShakeDraw/
├── ContentView.swift          # 主界面视图
├── SettingsView.swift         # 设置页（多文件夹导入/开关/删除）
├── FolderManager.swift        # 文件夹管理器（多文件夹 + 书签持久化）
├── ImageLoader.swift          # 图片加载器（支持多根目录）
├── RandomDrawManager.swift    # 抽签管理器（防重复 + 结果缓存）
├── ShakeDetector.swift        # 摇一摇检测器
├── ShakeDrawApp.swift         # 应用入口
└── Share to ShakeDraw/        # 分享扩展
    ├── ShareViewController.swift  # 分享扩展主控制器
    ├── Info.plist                # 扩展配置信息
    └── MainInterface.storyboard  # 扩展界面
```

### 主要功能模块

- **SettingsView**: 多文件夹导入、单独参与开关、左划删除与清空配置
- **FolderManager**: 管理多文件夹书签、权限与"参与抽签"开关
- **ImageLoader**: 负责图片加载、缓存和格式支持（支持多根目录）
- **RandomDrawManager**: 管理抽签逻辑、状态和结果缓存
- **ShakeDetector**: 检测设备摇动并触发抽签
- **ContentView**: 主界面，整合所有组件和用户交互
- **ShareViewController**: 分享扩展核心控制器，处理外部应用的图片分享

## 🎨 设计亮点

### 用户体验
- **直观的欢迎界面**：清晰的使用步骤指引
- **流畅的动画过渡**：精心设计的加载和结果展示动画
- **智能图片显示**：针对竖屏图片优化显示尺寸
- **优雅的错误处理**：友好的错误提示和恢复机制
- **无缝分享体验**：从任何应用一键保存图片到ShakeDraw
- **智能预览功能**：分享时自动显示图片预览或优雅占位图

### 技术特色
- **防重复算法**：智能排除当前图片，提供更好的随机体验
- **多线程优化**：后台加载图片，确保UI流畅性
- **内存管理**：高效的图片预解码和缓存策略
- **数据持久化**：使用UserDefaults和文件缓存保存状态
- **高级分享扩展**：
  - 智能内容类型检测（UTType.image、UTType.fileURL、UTType.url）
  - 异步状态管理，确保保存状态反馈准确
  - 网络图片优化处理，支持HTTP Content-Type检测
  - 多格式支持：JPEG、PNG、WebP、HEIC、GIF、BMP、TIFF

## 📝 更新日志

### v1.4.0 (2025-08-20)
- 🔧 **App Bundle配置修复**
  - 修复Bundle Identifier不匹配导致的模拟器启动失败问题
  - 统一App Group配置：`group.com.leorxx.ShakeDraw`
  - 完善entitlements文件配置，确保主应用和分享扩展正常协作
- 🖼️ **图片显示优化**
  - 增大图片在屏幕中的显示比例
  - 竖屏图片：高度占屏比从65%提升至75%，宽度从85%提升至92%
  - 横屏图片：高度从固定300px改为屏幕高度的45%，宽度提升至92%
  - 优化交叉淡入效果，图片切换更加自然流畅
- 🧹 **代码优化**
  - 精简调试日志输出，减少控制台干扰
  - 统一文件路径处理逻辑
  - 改进安全范围资源访问管理

### v1.3.0 (2025-08-20)
- 🚀 **新功能：分享扩展**
  - 支持从Safari、相册等任何iOS应用直接分享图片到ShakeDraw
  - 智能预览功能：自动显示图片缩略图或优雅占位图
  - 多格式支持：JPEG、PNG、WebP、HEIC、GIF、BMP、TIFF
  - 网络图片优化：智能Content-Type检测，支持Safari网页分享
- ⚡ **技术优化**
  - 异步状态管理：修复保存状态反馈不准确问题
  - 智能超时机制：预览加载从3秒延长至8秒，提高成功率
  - 性能优化：预览图自动缩放，减少内存占用
  - 错误处理增强：详细的调试日志，便于问题排查

### v1.2.0 (2025-08-20)
- ⚙️ 设置页：新增"多文件夹导入"，每个文件夹可单独控制"加入抽签"
- 🗑️ 管理：支持左划删除与"一键清空配置"（不删除磁盘文件）
- 🌓 深色模式：设置页图标/标签/开关色彩优化，提升暗黑可读性

### v1.1.2 (2025-08-19)
- 🖼️ 体验：新增图片间交叉淡入过渡，去除“抽签中”文字与动画覆盖
- 🎛️ 交互：将抽签按钮固定在左下角（仅在有图片时显示），点击即刻执行
- 🐞 修复：避免抽签时短暂闪回“摇一摇”提示；统一图片圆角显示
- 🧼 清理：移除不必要的点击延迟与相关说明

### v1.1.1 (2025-08-19)
- 🐞 修复：清除数据后返回欢迎页仍保留上次背景的问题（现已同步清空背景，且当权限被移除时也会清理背景）
- 🧹 清理：去重“上次结果恢复”逻辑，统一通过 `startRestoreIfNeeded()` 调用
- 🗑️ 精简：移除未使用方法（`commitReveal()`、`stopAccessing()`）与 UI 冗余状态
- 🔇 降噪：将若干调试日志置于 `#if DEBUG` 下，发布态更安静

### v1.1.0 (2025-08-19)
- 🖼️ 新增：当前结果图作为高斯模糊背景，避免空白过渡
- 🔘 新增：抽签按钮半透明毛玻璃样式，自适配深色模式
- ✋ 改进：按钮按压反馈（缩放、色彩叠加、触感）与轻微延迟，观感更明显
- ⚙️ 可调：支持自定义模糊强度与按钮反馈力度

### v1.0.0 (2025-08-19)
- ✨ 初版发布
- 🎨 苹果风格UI设计
- 🎯 防重复抽签机制
- 🔧 完整的文件管理功能
- 📱 夜间模式适配
- 🎭 精美的加载动画

## ⚙️ 自定义与拓展

- 背景模糊强度：在 `ShakeDraw/ContentView.swift` 的 `BlurredBackgroundView(image: blurRadius:)` 调整 `blurRadius`（默认 24）。
- 背景来源：背景自动使用最近一次抽签结果图；如需过渡背景，可用 `pendingTargetImage`。
- 按钮反馈力度：在 `PressableTranslucentCapsuleStyle` 调整以下参数：
  - 叠加透明度：静止 `0.12`、按下 `0.28`
  - 缩放幅度：按下 `0.96`
  - 亮度：按下 `brightness(-0.05)`
- 图片过渡参数：`CrossfadeResultView` 中可微调淡入时长（默认 0.28s）与缩放弹性（response 0.35，damping 0.85）。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

### 开发规范
- 遵循 Swift API 设计准则
- 保持代码简洁和注释完整
- 确保与现有架构兼容
- 添加适当的错误处理

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

## 👨‍💻 作者

**Leo Zhao** - *Initial work* - [leorxx11](https://github.com/leorxx11)

---

⭐ 如果这个项目对你有帮助，请给个 Star！

📧 有问题或建议？欢迎 [提交 Issue](https://github.com/leorxx11/ShakeDraw/issues)
