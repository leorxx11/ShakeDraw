# 🎲 ShakeDraw - 晃动抽签

一款简洁优雅的iOS随机抽签应用，通过摇动手机或点击按钮从图片文件夹中随机选择图片。

![iOS Version](https://img.shields.io/badge/iOS-18.0+-blue.svg)
![Swift Version](https://img.shields.io/badge/Swift-5.0+-orange.svg)
![License](https://img.shields.io/badge/License-MIT-green.svg)

## ✨ 特色功能

### 🎯 核心功能
- **智能抽签**：从图片文件夹中随机选择图片
- **防重复机制**：确保连续抽签不会重复当前图片
- **多种触发方式**：支持摇一摇手机或点击按钮
- **记忆功能**：自动记住上次抽签结果和选择的文件夹
- **多文件夹管理**：在设置页导入多个文件夹，单独控制是否参与抽签，左划删除
- **分享扩展**：支持从Safari、相册等应用直接分享图片到ShakeDraw

### 🎨 界面设计
- **苹果设计风格**：遵循 Apple Human Interface Guidelines
- **平滑过渡**：结果图片采用交叉淡入 + 轻微缩放过渡，切换更自然
- **夜间模式适配**：完美支持系统深色/浅色模式切换
- **响应式布局**：优化竖屏图片显示，智能调整图片尺寸
 - **高斯模糊背景**：使用当前结果图片作为全屏背景并高斯模糊，增强沉浸感
 - **半透明按钮（自适配深色）**：左下角骰子按钮为毛玻璃圆形，仅在有图片时显示
 - **可见的按压反馈**：按钮按下轻微缩放与色彩叠加；点击后立即执行（移除人为延迟）

### 🔧 高级功能
- **奖池管理**：设置 →「奖池」中导入多个文件夹、单独控制参与抽签，支持左划删除；内置「共享图片」文件夹（来自分享扩展）
- **敏感摇动检测**：优化的重力感应，提高触发灵敏度
- **缓存机制**：预加载和缓存图片，提供流畅体验
- **安全访问**：使用安全范围资源访问，保护用户隐私
- **体感跟随（视差）**：随设备轻微倾斜产生位移和 3D 倾斜效果（默认开启；设置 →「系数」中开关/强度；仅前台结果页运行；尊重“降低动态效果”）
- **交互范围可调**：设置 →「系数」中调节拖拽幅度（水平/垂直，5%–50%）与缩放范围（最小×0.5–最大×3.0），触达边界提供触觉反馈
- **回弹可调**：设置 →「系数」中调节回弹速度（0.1–0.6s）与幅度（0.5–1.0），更快更干净；一键“重置为推荐默认值”
- **智能分享扩展**：
  - 支持多种图片格式（JPEG、PNG、WebP、HEIC、GIF等）
  - 智能预览功能，自动缩放和占位图显示
  - 优化的网络图片处理，支持Safari网页分享
  - 异步状态同步，确保保存状态反馈准确

## 📱 系统要求

- iOS 18.0+
- Xcode 15.0+
- Swift 5.0+

## 🚀 快速开始

### 安装运行

1. 克隆项目到本地
```bash
git clone https://github.com/leorxx11/ShakeDraw.git
cd ShakeDraw
```

2. 使用 Xcode 打开项目
```bash
open ShakeDraw.xcodeproj
```

3. 选择目标设备或模拟器，点击运行

### 使用方法

#### 主要功能
1. **打开设置**：主界面右上角齿轮按钮进入“设置”
2. **导入文件夹**：进入“奖池”，右上角“添加”导入一个或多个文件夹
3. **参与开关**：在“奖池”中为每个文件夹单独控制“加入抽签”，可左划删除
4. **开始抽签**：回到主界面，摇动手机或点击左下角骰子按钮
5. **享受结果**：查看随机选中的图片；再次点击左下角按钮继续

#### 体感跟随（可选）
- 设置 →「系数」→「体感跟随」：开启/关闭与强度调节（0%~100%）
- 不会触发摇一摇，仅在结果图片展示时生效；若系统开启“降低动态效果”，将自动停用

#### 交互范围（可选）
- 设置 →「系数」→「交互范围」：拖拽幅度（水平/垂直 5%–50%）与缩放范围（×0.5~×3.0）
- 达到拖拽/缩放边界时，会有轻微触觉反馈提示

#### 系数总览与重置
- 设置 →「系数」顶部提供雷达统计图（灰色=默认，蓝色=当前）快速总览；底部可一键“重置为推荐默认值”。

#### 分享扩展
6. **Safari分享**：在Safari浏览图片时，点击分享按钮选择"ShakeDraw"
7. **相册分享**：在相册中选择图片，通过分享菜单选择"ShakeDraw"
8. **其他应用**：支持任何可分享图片的iOS应用

## 🏗️ 项目架构

### 核心组件
```
ShakeDraw/
├── ContentView.swift          # 主界面视图
├── SettingsView.swift         # 设置页主入口（仅“奖池/系数”两项；含雷达图与重置）
├── FolderManager.swift        # 文件夹管理器（多文件夹 + 书签持久化）
├── ImageLoader.swift          # 图片加载器（支持多根目录）
├── RandomDrawManager.swift    # 抽签管理器（防重复 + 结果缓存）
├── ShakeDetector.swift        # 摇一摇检测器
├── MotionParallaxManager.swift# 体感跟随（CoreMotion 姿态/重力 -> 视差/倾斜）
├── ShakeDrawApp.swift         # 应用入口
└── Share to ShakeDraw/        # 分享扩展
    ├── ShareViewController.swift  # 分享扩展主控制器
    ├── Info.plist                # 扩展配置信息
    └── MainInterface.storyboard  # 扩展界面
```

### 主要功能模块

- **SettingsView**: 多文件夹导入、单独参与开关、左划删除与清空配置
- **FolderManager**: 管理多文件夹书签、权限与"参与抽签"开关
- **ImageLoader**: 负责图片加载、缓存和格式支持（支持多根目录）
- **RandomDrawManager**: 管理抽签逻辑、状态和结果缓存
- **ShakeDetector**: 检测设备摇动并触发抽签
- **ContentView**: 主界面，整合所有组件和用户交互
- **ShareViewController**: 分享扩展核心控制器，处理外部应用的图片分享

## 🎨 设计亮点

### 用户体验
- **直观的欢迎界面**：清晰的使用步骤指引
- **流畅的动画过渡**：精心设计的加载和结果展示动画
- **智能图片显示**：针对竖屏图片优化显示尺寸
- **优雅的错误处理**：友好的错误提示和恢复机制
- **无缝分享体验**：从任何应用一键保存图片到ShakeDraw
- **智能预览功能**：分享时自动显示图片预览或优雅占位图

### 技术特色
- **防重复算法**：智能排除当前图片，提供更好的随机体验
- **多线程优化**：后台加载图片，确保UI流畅性
- **内存管理**：高效的图片预解码和缓存策略
- **数据持久化**：使用UserDefaults和文件缓存保存状态
- **高级分享扩展**：
  - 智能内容类型检测（UTType.image、UTType.fileURL、UTType.url）
  - 异步状态管理，确保保存状态反馈准确
  - 网络图片优化处理，支持HTTP Content-Type检测
  - 多格式支持：JPEG、PNG、WebP、HEIC、GIF、BMP、TIFF

## 🧭 开发总结

- 设置重构：将设置页拆为“奖池 / 系数”两大子菜单，主菜单更简洁，定位更清晰。
- 体感跟随：CoreMotion deviceMotion + 基线校准 + 低通滤波（α=0.18）+ 死区（±0.04），尊重“降低动态效果”。
- 交互限制与触觉：拖拽按屏幕比例（X/Y 分离）与缩放范围限制，触达边界与极值提供触觉反馈（去抖）。
- 回弹参数化：统一用可调 response/damping 控制回弹（速度 0.1–0.6s、幅度 0.5–1.0），默认更快更干净。
- 系数总览与重置：新增雷达统计图（灰=默认，蓝=当前）；一键恢复推荐默认值。
- 共享图片：App Group（`group.com.leorxx.ShakeDraw`）接收分享扩展图片，出现在“奖池”中，可单独参与/管理。

## ⚙️ 自定义与拓展

- 背景模糊强度：在 `ShakeDraw/ContentView.swift` 的 `BlurredBackgroundView(image: blurRadius:)` 调整 `blurRadius`（默认 24）。
- 背景来源：背景自动使用最近一次抽签结果图；如需过渡背景，可用 `pendingTargetImage`。
- 按钮反馈力度：在 `PressableTranslucentCapsuleStyle` 调整以下参数：
  - 叠加透明度：静止 `0.12`、按下 `0.28`
  - 缩放幅度：按下 `0.96`
  - 亮度：按下 `brightness(-0.05)`
- 图片过渡参数：`CrossfadeResultView` 中可微调淡入时长（默认 0.28s）与缩放弹性（response 0.35，damping 0.85）。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

### 开发规范
- 遵循 Swift API 设计准则
- 保持代码简洁和注释完整
- 确保与现有架构兼容
- 添加适当的错误处理

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

## 👨‍💻 作者

**Leo Zhao** - *Initial work* - [leorxx11](https://github.com/leorxx11)

---

⭐ 如果这个项目对你有帮助，请给个 Star！

📧 有问题或建议？欢迎 [提交 Issue](https://github.com/leorxx11/ShakeDraw/issues)
